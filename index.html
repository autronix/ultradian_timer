<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Ultradian Timer</title>
    <script src="scripts/jquery-1.11.1.min.js"></script>
    <script src="scripts/jquery-ui.min.js"></script>
    <script src="scripts/jquery.TimeCircles.js"></script>

    <link rel="stylesheet" type="text/css" href="styles/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="styles/jquery-ui.structure.min.css">
    <link rel="stylesheet" type="text/css" href="styles/jquery-ui.theme.min.css">
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="styles/TimeCircles.css">

    <style>
        body {
            background: #3b3b3b;
            font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
            font-size: 12px;
        }

        #wrapper {
            position: absolute;
            top: 50%;
            margin-top: -350px;
            left: 50%;
            margin-left: -350px;

            width: 700px;
            height: 700px;

            -webkit-border-radius: 20px;
            -moz-border-radius: 20px;
            border-radius: 20px;

            border: solid thin #757469;
            background: #fff;
        }

        #counter {
            width: 100%;
        }

        #controls {
            width: 100%;
            text-align: center;
            margin-top: 10px;
        }

        #setup {
            width: 650px;
            margin-left: 25px;
            margin-top: 20px;
        }

    </style>

    <script>
        $(document).ready(function() {

            $timerFlag = 0;
            $isRunning = 0;

            $( "#work-slider" ).slider({
                range: "min",
                value: 90, //90
                min: 80, //80
                max: 110,
                slide: function( event, ui ) {
                    $( "#work-amount" ).val( "" + ui.value + " min" );
                    updateTimer(ui.value,0);
                }
            });
            $( "#work-amount" ).val( "" + $( "#work-slider" ).slider( "value" ) + "min" );

            $( "#break-slider" ).slider({
                range: "min",
                value: 20, //20
                min: 15, //15
                max: 30,
                slide: function( event, ui ) {
                    $( "#break-amount" ).val( "" + ui.value +" min" );
                    updateTimer(ui.value,1);
                }
            });
            $( "#break-amount" ).val( "" + $( "#break-slider" ).slider( "value" ) + "min" );

            createTimer($("#work-slider").slider("value") * 60);

            $(".startTimer").click(function() {
                $("#counter").TimeCircles().restart();
                $(".stopTimer").removeAttr("disabled");
                $(".splitTimer").removeAttr("disabled");
                $(this).attr("disabled", "");
                $isRunning = 1;
                playSound(0);
            });

            $(".stopTimer").click(function() {
                $("#counter").TimeCircles().stop();
                $(".startTimer").removeAttr("disabled");
                $(this).attr("disabled", "");
                $(".splitTimer").attr("disabled", "");
                $(".splitTimer").html("Take Break");
                $isRunning = 0;
                $timerFlag = 0;
                updateTimer($( "#work-slider" ).slider( "value" ) ,0);
                playSound(3);
            });

            $(".splitTimer").click(function() {

                // get current countdown value
                var val = $("#counter").data('timer');
                if($timerFlag == 1) {
                    createTimer($("#work-slider").slider("value") * 60);
                    //$("#counter").data('timer', "5400");
                    $timerFlag = 0;
                    $(".splitTimer").html("Take Break");
                }
                else {
                    createTimer($("#break-slider").slider("value") * 60);
                    //$("#counter").data('timer', "1200");
                    $timerFlag = 1
                    $(".splitTimer").html("Resume Work");
                }
                playSound(0);

                //$("#counter").TimeCircles().destroy();
                //createTimer("1200");
                $("#counter").TimeCircles().start(); //*/
            });
        });

        function updateTimer(time, flag){
            if($isRunning == 0) {
                if (flag == $timerFlag) {
                    createTimer(time * 60);
                }
            }
        }

        function createTimer(time){
            $("#counter").data('timer', "" + time);
            $("#counter").TimeCircles().destroy();
            $("#counter").TimeCircles({ "animation": "smooth",
                "bg_width": 0.6,
                "fg_width": 0.07,
                time: { Days: { show: false } }
            }).addListener(function(unit,value,total){
                if($timerFlag == 0 && total == 0)
                    playSound(1);
                else if($timerFlag == 1 && total == 0)
                    playSound(2);
                    }).stop();
        }

        function playSound(sound){

            var path = "audio/";
            var audio="";

            switch(sound){
                case 0: audio = path+"start.mp3";
                        break;
                case 1: audio = path+"startbreak.mp3";
                        break;
                case 2: audio = path+"endbreak2.mp3";
                        break;
                case 3: audio = path+"stop.mp3";
                        break;
            }

            var audioElement = document.createElement('audio');
            audioElement.setAttribute('src', audio);
            audioElement.setAttribute('autoplay', 'autoplay');

            audioElement.play()
            /*audioElement.addEventListener("load", function() {
                audioElement.play();
            }, true);//*/
        }
    </script>

</head>
<body>

    <div id="wrapper">
        <div id="counter"></div>
        <div id="controls">
            <button class="btn btn-success startTimer">Start Session</button>
            <button class="btn btn-info splitTimer" disabled>Take Break</button>
            <button class="btn btn-danger stopTimer" disabled>Stop Session</button>
        </div>
        <div id="setup">
            <label for="work-amount">Work Time:</label>
            <input type="text" id="work-amount" readonly style="border:0; color:#f6931f; font-weight:bold;">
            <div id="work-slider"></div>
            <label for="break-amount">Break Time:</label>
            <input type="text" id="break-amount" readonly style="border:0; color:#f6931f; font-weight:bold;">
            <div id="break-slider"></div>
        </div>
    </div>

</body>
</html>